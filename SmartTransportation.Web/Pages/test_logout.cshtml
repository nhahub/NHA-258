@page
@model SmartTransportation.Pages.TestLogoutModel
@{
    ViewData["Title"] = "Test Logout";
    Layout = null; // No layout for pure testing
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Test Logout</title>
    <style>
        body { font-family: Arial; padding: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .status { padding: 20px; border-radius: 4px; margin-bottom: 20px; }
        .logged-in { background: #d1fae5; border: 2px solid #10b981; }
        .logged-out { background: #fee2e2; border: 2px solid #ef4444; }
        button { padding: 12px 24px; font-size: 16px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-logout { background: #ef4444; color: white; }
        .btn-login { background: #3b82f6; color: white; }
        pre { background: #f3f4f6; padding: 15px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Logout Test Page</h1>

        <div class="status @(User.Identity?.IsAuthenticated == true ? "logged-in" : "logged-out")">
            <h2>Current Status: @(User.Identity?.IsAuthenticated == true ? "‚úÖ LOGGED IN" : "‚ùå LOGGED OUT")</h2>
            <pre>
User Name: @(User.Identity?.Name ?? "None")
User Role: @(User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role)?.Value ?? "None")
Claims Count: @User.Claims.Count()
Time: @DateTime.Now.ToString("HH:mm:ss")
            </pre>
        </div>

        @if (User.Identity?.IsAuthenticated == true)
        {
            <h3>You are logged in. Click button below to logout:</h3>
            <form method="post" id="logoutForm">
                <button type="submit" class="btn-logout" id="logoutBtn">üö™ LOGOUT NOW</button>
            </form>

            <script>
                document.getElementById('logoutForm').addEventListener('submit', function(e) {
                    document.getElementById('logoutBtn').textContent = '‚è≥ Logging out...';
                    document.getElementById('logoutBtn').disabled = true;
                });
            </script>
        }
        else
        {
            <h3>You are logged out. Test successful!</h3>
            <a href="/Log_in" class="btn-login" style="display: inline-block; text-decoration: none;">
                üîë Go to Login
            </a>
        }

        <hr style="margin: 30px 0;">

        <h3>Debug Actions:</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <a href="/Index" style="padding: 10px 20px; background: #6b7280; color: white; border-radius: 4px; text-decoration: none;">
                üè† Go to Index
            </a>
            <button onclick="location.reload()" style="padding: 10px 20px; background: #6b7280; color: white;">
                üîÑ Refresh Page
            </button>
            <button onclick="clearCache()" style="padding: 10px 20px; background: #6b7280; color: white;">
                üóëÔ∏è Clear Cache & Reload
            </button>
        </div>

        <script>
            function clearCache() {
                // Clear session storage
                sessionStorage.clear();
                // Hard reload
                location.reload(true);
            }
        </script>

        @if (TempData["LogoutDebug"] != null)
        {
            <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border: 2px solid #f59e0b; border-radius: 4px;">
                <h4>Logout Debug Info:</h4>
                <pre>@TempData["LogoutDebug"]</pre>
            </div>
        }
    </div>
</body>
</html>